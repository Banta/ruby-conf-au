// Generated by CoffeeScript 1.3.1
(function() {

  $(function() {
    var Form;
    Form = (function() {

      Form.name = 'Form';

      function Form() {
        this.el = $('form');
        this.inputEl = this.el.find('input').first();
        this.buttonEl = this.el.find('input.button');
        this.progressEl = this.el.find('.progress');
        this.successEl = this.el.find('.success');
        this._initHandlers();
      }

      Form.prototype.email = function() {
        return $.trim(this.inputEl.val());
      };

      Form.prototype.isEmailValid = function() {
        return this.email().match(/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i) !== null;
      };

      Form.prototype._initHandlers = function() {
        var _this = this;
        this.el.submit(function() {
          _this._handleSubmission();
          return false;
        });
        return this.buttonEl.click(function() {
          _this._handleSubmission();
          return false;
        });
      };

      Form.prototype._handleSubmission = function() {
        var _this = this;
        if (this.isEmailValid()) {
          this.inputEl.removeClass('error').attr('readonly', 'readonly');
          this.buttonEl.hide();
          this.successEl.hide();
          this.progressEl.show();
          return $.ajax({
            type: "POST",
            url: "/subscribe",
            data: {
              'email': this.email()
            },
            success: function() {
              console.log('success');
              _this.progressEl.hide();
              return _this.successEl.show();
            }
          });
        } else {
          return this.inputEl.addClass('error');
        }
      };

      return Form;

    })();
    return new Form();
  });

}).call(this);
